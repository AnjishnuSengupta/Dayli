<!DOCTYPE html>
<html>
<head>
    <title>MinIO Browser Test</title>
</head>
<body>
    <h1>MinIO Browser Upload Test</h1>
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="testUpload()">Test Upload</button>
    <div id="result"></div>
    
    <script>
        async function testUpload() {
            const fileInput = document.getElementById('fileInput');
            const result = document.getElementById('result');
            
            if (!fileInput.files[0]) {
                result.innerHTML = 'Please select a file first';
                return;
            }
            
            const file = fileInput.files[0];
            result.innerHTML = 'Uploading...';
            
            try {
                // Test our browser MinIO implementation
                const endpoint = 'http://localhost:9000';
                const bucket = 'dayli-uploads';
                const objectName = `test-browser-${Date.now()}-${file.name}`;
                const uploadUrl = `${endpoint}/${bucket}/${objectName}`;
                
                console.log('Uploading to:', uploadUrl);
                
                // Try simple PUT first
                let response = await fetch(uploadUrl, {
                    method: 'PUT',
                    body: file,
                    headers: {
                        'Content-Type': file.type,
                    }
                });
                
                if (!response.ok) {
                    // Try with basic auth
                    const authHeader = 'Basic ' + btoa('minioadmin:minioadmin123');
                    response = await fetch(uploadUrl, {
                        method: 'PUT',
                        body: file,
                        headers: {
                            'Content-Type': file.type,
                            'Authorization': authHeader
                        }
                    });
                }
                
                if (response.ok) {
                    result.innerHTML = `✅ Upload successful!<br>URL: <a href="${uploadUrl}" target="_blank">${uploadUrl}</a>`;
                } else {
                    const errorText = await response.text();
                    result.innerHTML = `❌ Upload failed: ${response.status} ${response.statusText}<br>${errorText}`;
                }
                
            } catch (error) {
                console.error('Upload error:', error);
                result.innerHTML = `❌ Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
